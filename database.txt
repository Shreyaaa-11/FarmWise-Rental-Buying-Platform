profiles table:


orders table :
create table orders (
  id uuid default uuid_generate_v4() primary key,
  user_id uuid references auth.users on delete cascade not null,
  total_amount numeric not null,
  shipping_address jsonb not null,
  status text not null,
  payment_intent_id text,
  is_rental boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

order_items table :
create table order_items (
  id uuid default uuid_generate_v4() primary key,
  order_id uuid references orders on delete cascade not null,
  equipment_id uuid references equipment on delete restrict not null,
  quantity integer not null,
  price numeric not null,
  is_rental boolean default false,
  rental_start_date timestamp with time zone,
  rental_end_date timestamp with time zone,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

carts table :
create table carts (
  id uuid default uuid_generate_v4() primary key,
  user_id uuid references auth.users on delete cascade not null,
  equipment_id uuid references equipment on delete cascade not null,
  quantity integer not null,
  rental boolean default false,
  rental_start_date timestamp with time zone,
  rental_end_date timestamp with time zone,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

equipments table : create table equipment (
  id uuid default uuid_generate_v4() primary key,
  name text not null,
  description text,
  price numeric not null,
  image_url text,
  category text,
  available boolean default true,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);


Policies: 
-- Enable RLS on all tables
alter table profiles enable row level security;
alter table orders enable row level security;
alter table order_items enable row level security;
alter table carts enable row level security;
alter table equipment enable row level security;

-- Profiles policies
create policy "Users can view own profile"
on profiles for select
using (auth.uid() = id);

create policy "Users can update own profile"
on profiles for update
using (auth.uid() = id);

create policy "Users can insert own profile"
on profiles for insert
with check (auth.uid() = id);

-- Orders policies
create policy "Users can view own orders"
on orders for select
using (auth.uid() = user_id);

create policy "Users can create own orders"
on orders for insert
with check (auth.uid() = user_id);

-- Order items policies
create policy "Users can view own order items"
on order_items for select
using (exists (
  select 1 from orders
  where orders.id = order_items.order_id
  and orders.user_id = auth.uid()
));

create policy "Users can create own order items"
on order_items for insert
with check (exists (
  select 1 from orders
  where orders.id = order_items.order_id
  and orders.user_id = auth.uid()
));

-- Carts policies
create policy "Users can view own cart"
on carts for select
using (auth.uid() = user_id);

create policy "Users can manage own cart"
on carts for all
using (auth.uid() = user_id);

-- Equipment policies
create policy "Anyone can view equipment"
on equipment for select
to authenticated
using (true);
